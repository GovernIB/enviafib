<?xml version="1.0" encoding="UTF-8" ?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<artifactId>enviafib-ear</artifactId>
	<packaging>ear</packaging>

	<parent>
		<groupId>es.caib.enviafib</groupId>
		<artifactId>enviafib</artifactId>
		<version>1.0.5</version>
	</parent>

	<name>EnviaFIB - Ear</name>


	<properties>
		<!-- Format del timestamp -->
		<maven.build.timestamp.format>dd/MM/yyyy HH:mm</maven.build.timestamp.format>
	</properties>

	<dependencies>
		<!-- Internes -->
		<dependency>
			<groupId>es.caib.enviafib</groupId>
			<artifactId>enviafib-persistence</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>es.caib.enviafib</groupId>
			<artifactId>enviafib-ejb</artifactId>
			<version>${project.version}</version>
			<type>ejb</type>
		</dependency>
		<dependency>
			<groupId>es.caib.enviafib</groupId>
			<artifactId>enviafib-back</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		
		<dependency>
			<groupId>es.caib.enviafib</groupId>
			<artifactId>enviafib-front</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		
		
		<!-- API INTERNA START -->
		<dependency>
			<groupId>es.caib.enviafib</groupId>
			<artifactId>enviafib-api-interna</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<!-- API INTERNA END -->


		<!-- Tenir en compte a l'hora de incloure dependències només si és imprescindible 
			i no està ja dins un mòdul sobre el que es pugui establir una dependència 
			als descriptors. https://docs.jboss.org/author/display/AS72/Implicit+module+dependencies+for+deployments -->
		<dependency>
			<groupId>org.slf4j</groupId>
			<artifactId>slf4j-api</artifactId>
		</dependency>



		<!-- Externes -->
		<!-- ====================================== -->
		<!-- ===== PLUGINS DE USERINFORMATION ===== -->
		<!-- ====================================== -->
		<dependency>
			<groupId>org.fundaciobit.pluginsib.userinformation</groupId>
			<artifactId>pluginsib-userinformation-keycloak</artifactId>
			<version>${pluginsib.userinformation.impl.version}</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.jboss.resteasy</groupId>
					<artifactId>resteasy-client</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.jboss.resteasy</groupId>
					<artifactId>resteasy-multipart-provider</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.jboss.resteasy</groupId>
					<artifactId>resteasy-jaxrs</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.jboss.resteasy</groupId>
					<artifactId>resteasy-jaxb-provider</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.jboss.resteasy</groupId>
					<artifactId>resteasy-jackson2-provider</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.fundaciobit.pluginsib.userinformation</groupId>
			<artifactId>pluginsib-userinformation-database</artifactId>
			<version>${pluginsib.userinformation.impl.version}</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.fundaciobit.pluginsib.userinformation</groupId>
			<artifactId>pluginsib-userinformation-ldap</artifactId>
			<version>${pluginsib.userinformation.impl.version}</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<!-- ============================================ -->
		<!-- ========== PLUGINS DE DATAEXPORT =========== -->
		<!-- ============================================ -->
		<!-- API -->
		<dependency>
			<groupId>org.fundaciobit.pluginsib.exportdata</groupId>
			<artifactId>pluginsib-exportdata-api</artifactId>
			<version>2.0.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<!-- Excel Plugin -->
		<dependency>
			<groupId>org.fundaciobit.pluginsib.exportdata</groupId>
			<artifactId>pluginsib-exportdata-excel</artifactId>
			<version>2.0.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.apache.poi</groupId>
			<artifactId>poi</artifactId>
			<version>3.9</version>
		</dependency>
		<!-- ODS Plugin -->
		<dependency>
			<groupId>org.fundaciobit.pluginsib.exportdata</groupId>
			<artifactId>pluginsib-exportdata-ods</artifactId>
			<version>2.0.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.jopendocument</groupId>
			<artifactId>jOpenDocument</artifactId>
			<version>1.3b1</version>
		</dependency>
		<!-- CSV Plugin -->
		<dependency>
			<groupId>org.fundaciobit.pluginsib.exportdata</groupId>
			<artifactId>pluginsib-exportdata-csv</artifactId>
			<version>2.0.0</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<!-- Commons Dependencies -->
		<dependency>
			<groupId>commons-fileupload</groupId>
			<artifactId>commons-fileupload</artifactId>
			<version>1.3</version>
			<exclusions>
				<exclusion>
					<groupId>commons-io</groupId>
					<artifactId>commons-io</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		
		
		<dependency>
			<groupId>commons-io</groupId>
			<artifactId>commons-io</artifactId>
			<!--
			<version>2.6</version>
			-->
		</dependency>
		<dependency>
			<groupId>apache-lang</groupId>
			<artifactId>commons-lang</artifactId>
			<version>2.0</version>
		</dependency>
		<!--
		<dependency>
			<groupId>commons-logging</groupId>
			<artifactId>commons-logging</artifactId>
			<version>1.1.1</version>
		</dependency>
		<dependency>
			<groupId>commons-digester</groupId>
			<artifactId>commons-digester</artifactId>
			<version>2.0</version>
		</dependency>
		-->

		<!-- DEPENDENCIES DE ARXIU-->

		<dependency>
			<groupId>org.fundaciobit.pluginsib.arxiu</groupId>
			<artifactId>pluginsib-arxiu-caib</artifactId>
			<version>${pluginsib.arxiu.version}</version>
			<exclusions>
				<exclusion>
					<groupId>org.fundaciobit.pluginsib.core</groupId>
					<artifactId>pluginsib-core</artifactId>
				</exclusion>
				<exclusion>
					<groupId>com.sun.jersey</groupId>
					<artifactId>jersey-client</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
	
		<!-- ============================================ -->
		<!-- ==== PLUGINS DE ESTRUCTURA ORGANITZATIVA === -->
		<!-- ============================================ -->

		<dependency>
			<groupId>org.fundaciobit.pluginsib.estructuraorganitzativa</groupId>
		    <artifactId>pluginsib-estructuraorganitzativa-mock</artifactId>
			<version>1.0.5</version>
		</dependency>
		
		<dependency>
			<groupId>org.fundaciobit.pluginsib.estructuraorganitzativa</groupId>
		    <artifactId>pluginsib-estructuraorganitzativa-database</artifactId>
			<version>1.0.5</version>
		</dependency>

	</dependencies>



	<build>
		<finalName>enviafib</finalName>

		<filters>
			<filter>../config.properties</filter>
		</filters>
		<pluginManagement>
			<plugins>
				<plugin>
					<artifactId>maven-clean-plugin</artifactId>
					<!-- Aquest bloc força a netejar sempre -->
					<executions>
						<execution>
							<id>auto-clean</id>
							<phase>initialize</phase>
							<goals>
								<goal>clean</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-ear-plugin</artifactId>
	
					<!-- configuring the ear plugin -->
					<configuration>
	
						<displayName>EnviaFIB</displayName>
						<description>EnviaFIB</description>
	
						<generateApplicationXml>true</generateApplicationXml>
						<defaultLibBundleDir>lib</defaultLibBundleDir>
						<includeLibInApplicationXml>false</includeLibInApplicationXml>
						<!--suppress UnresolvedMavenProperty -->
						<!-- Nom mòduls d'acord amb punt 4.2 de l'Estàndard CAIB -->
						<outputFileNameMapping>@{artifactId}@-@{version}@.@{extension}@</outputFileNameMapping>
						<version>8</version>
	
						<archive>
							<manifest>
								<addDefaultImplementationEntries>true</addDefaultImplementationEntries>
							</manifest>
							<manifestEntries>
								<project-version>${project.version}</project-version>
								<project-buildtime>${maven.build.timestamp}</project-buildtime>
								<scm-revision>${buildNumber}</scm-revision>
							</manifestEntries>
						</archive>
	
						<defaultLibBundleDir>lib</defaultLibBundleDir>
	
						<modules>

							<webModule>
								<groupId>es.caib.enviafib</groupId>
								<artifactId>enviafib-back</artifactId>
								<contextRoot>enviafibback</contextRoot>
	                            <bundleFileName>enviafib-back.war</bundleFileName>
							</webModule>
							
							<webModule>
						    <groupId>es.caib.enviafib</groupId>
								<artifactId>enviafib-front</artifactId>
								<contextRoot>enviafibfront</contextRoot>
	                            <bundleFileName>enviafib-front.war</bundleFileName>
							</webModule>

							<ejbModule>
								<groupId>es.caib.enviafib</groupId>
								<artifactId>enviafib-ejb</artifactId>
								<bundleFileName>enviafib-ejb.jar</bundleFileName>
							</ejbModule>
	
							<!-- API INTERNA START -->
							<webModule>
								<groupId>es.caib.enviafib</groupId>
								<artifactId>enviafib-api-interna</artifactId>
								<contextRoot>/enviafibapi/interna</contextRoot>
								<bundleFileName>enviafib-api-interna.war</bundleFileName>
							</webModule>
							<!-- API INTERNA END -->
	
						</modules>
					</configuration>
				</plugin>
	
				<!-- Per arrencar/desplegar automàticament l'aplicació. 
				     Documentació ús: https://codehaus-cargo.github.io/cargo/Maven2+plugin.html 
					configuració: https://codehaus-cargo.github.io/cargo/Maven2+Plugin+Reference+Guide.html 
			   -->
				<plugin>
					<groupId>org.codehaus.cargo</groupId>
					<artifactId>cargo-maven2-plugin</artifactId>
					<configuration>
						<skip>false</skip>
						<container>
							<!-- El plugin cargo empra la configuració wildfly13x pel JBoss EAP 
								7.2 -->
							<containerId>wildfly13x</containerId>
							<type>installed</type>
							<home>${env.JBOSS_HOME}</home>
						</container>
						<configuration>
							<!-- Empra la configuració existent del servidor d'aplicacions. -->
							<type>existing</type>
							<home>${env.JBOSS_HOME}/standalone</home>
							<!-- Si volem arrancar el jboss amb cargo:start i amb una configuració 
								copiada de l'original, fixar el <type> a standalone i llevar el <home> -->
							<properties>
								<cargo.hostname>localhost</cargo.hostname>
								<cargo.port.offset>0</cargo.port.offset>
								<cargo.remote.username>admin</cargo.remote.username>
								<cargo.remote.password>admin</cargo.remote.password>
							</properties>
						</configuration>
						<deployables>
							<deployable>
								<properties>
									<name>${project.build.finalName}</name>
								</properties>
							</deployable>
						</deployables>
					</configuration>
				</plugin>
				<!--This plugin's configuration is used to store Eclipse m2e settings only. It has no influence on the Maven build itself.-->
				<plugin>
					<groupId>org.eclipse.m2e</groupId>
					<artifactId>lifecycle-mapping</artifactId>
					<version>1.0.0</version>
					<configuration>
						<lifecycleMappingMetadata>
							<pluginExecutions>
								<pluginExecution>
									<pluginExecutionFilter>
										<groupId>
											org.apache.maven.plugins
										</groupId>
										<artifactId>
											maven-clean-plugin
										</artifactId>
										<versionRange>
											[3.1.0,)
										</versionRange>
										<goals>
											<goal>clean</goal>
										</goals>
									</pluginExecutionFilter>
									<action>
										<ignore></ignore>
									</action>
								</pluginExecution>
							</pluginExecutions>
						</lifecycleMappingMetadata>
					</configuration>
				</plugin>
			</plugins>
		</pluginManagement>
	</build>
	
	
    <profiles>
        <!-- Garantir que es fixa la variable d'entorn JBOSS_HOME -->
        <profile>
            <id>fix JBOSS_HOME</id>
            <activation>
                <property>
                    <name>!env.JBOSS_HOME</name>
                </property>
            </activation>
            <properties>
                <env.JBOSS_HOME>HA DE FIXAR LA VARIABLE D'ENTORN JBOSS_HOME</env.JBOSS_HOME>
            </properties>
        </profile>
        <profile>
          <id>revisionnumber</id>
          <build>
            <plugins>
                <!-- Defineix la propietat ${buildNumber} que s'empra al filtrat -->
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>buildnumber-maven-plugin</artifactId>
                </plugin>
            </plugins>
          </build>
        </profile>
    </profiles>

</project>
